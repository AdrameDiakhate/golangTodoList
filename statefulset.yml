# Secret

apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
stringData: # We dont need to worry about converting to base64
  # MYSQL_USER: root
  MYSQL_PASSWORD: ada
  MYSQL_DATABASE: golangTodoList
  MYSQL_ROOT_PASSWORD: ada

  DB_HOST: mysql-service
  DB_DRIVER: mysql
  # API_SECRET: 98hbun98h
  # DB_USER: root
  DB_PASSWORD: ada
  DB_NAME: golangTodoList
  DB_PORT: "3306"

---
# Service for mysql

apiVersion: v1
kind: Service
metadata:
  name: mysql-service
  labels:
    app: mysql
spec:
  clusterIP: None
  selector:
    app: mysql
  ports:
    - name: tcp
      protocol: TCP
      port: 3306

---
#Statefulset

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql
spec:
  replicas: 1
  serviceName: mysql-service
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      terminationGracePeriodSeconds: 10
      containers:
        - name: mysql
          image: mysql:5.6
          envFrom: # Get the environmental variables from a secret file whose name is "postgres-secret"
            - secretRef:
                name: mysecret
          ports:
            - name: tpc
              protocol: TCP
              containerPort: 3306
          volumeMounts:
            - name: data
              mountPath: /etc/data
  volumeClaimTemplates:
    - metadata:
        name: data
      spec:
        storageClassName: standard
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi

---

apiVersion: v1                           # API version
kind: Service                            # Type of kubernetes resource 
metadata:
  name: golang-service                # Name of the resource
  labels:                                # Labels that will be applied to the resource
    app: golangtodolist
spec:
  type: NodePort
  ports:
    - port: 9091
  selector:                              # Selects any Pod with labels `app=fullstack-mysql,tier=mysql`
    app: golangtodolist
    tier: go


---

#Deployment for golang

apiVersion: apps/v1

kind: Deployment

metadata:
  name: golangtodolist

  labels:
    app: golangtodolist

spec:
  replicas: 1
  selector:
    matchLabels:
      app: golangtodolist
  template:
    metadata:
      labels:
        app: golangtodolist
        tier: go
    spec:
      containers:
        - name: golangtodolist
          image: adrame98/golangtodolist:v1.1.6
          envFrom: # Get the environmental variables from a secret file whose name is "postgres-secret"
            - secretRef:
                name: mysecret
          ports:
            - containerPort: 9091